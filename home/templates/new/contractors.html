{% extends 'new/base.html' %}
{% load widget_tweaks %}
{% load static %}

{% block content %}


<div class="card mb-3">
    <!-- <div class="card-header py-3  bg-transparent border-bottom-0">
        <button type="button" href="#" data-bs-toggle="modal" data-bs-target="#add-user-model" class="btn btn-icon btn-warning">Create User</button> 
    </div> -->
    <div class="card-body">
        <table id="patient-table" class="table table-hover align-middle mb-0" style="width: 100%;">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Company Name</th>
                    <th>Category</th>
                    <th>Email</th>
                    <th>Register Date</th>
                    <th>Status</th>
                    
                </tr>
            </thead>
            <tbody>
                {% for contractor in contractors %}
                    <tr>
                        <td>{{ forloop.counter}}</td>
                        <td>{{ contractor.company_name }}</td>
                        <td></td>
                        <td>{{contractor.account.email}} </td>
                        <td>{{contractor.account.date_joined}}</td>
                        <td> {{contractor.status}} </td>
                        <td><a href="{% url 'contractor_document_list' contractor_id=contractor.id %}" class="btn btn-secondary">Check</a></td>
                        <!-- <td>
                            <form id="update-form" data-pk="{{ contractor.pk }}" action="{% url 'contractor_update' contractor_pk=contractor.pk %}">
                                {% csrf_token %}
                                <select id="status-select">
                                  <option value="verified">Verified</option>
                                  <option value="pending">Pending</option>
                                </select>
                                <button class="btn btn-primary"  type="button" id="update-btn">Update Status</button>
                              </form>                    
                        </td> -->
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock content %}
{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
      $('#update-btn').on('click', function() {
        var status = $('#status-select').val();
        var pk = $('#update-form').data('pk');
  
        $.ajax({
          url: '/contractors/' + pk + '/update',
          type: 'POST',
          data: {
            status: status,
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
          },
          success: function(response) {
            alert(response.message);
            // Perform any additional actions upon success
            location.reload(); // Reload the page upon success
          },
          error: function(xhr, errmsg, err) {
            alert(err);
            console.log(err)
          }
        });
      });
    });
  </script>
    
  
{% endblock scripts %}